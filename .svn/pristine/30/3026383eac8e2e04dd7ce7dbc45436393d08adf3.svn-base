#!/bin/sh
#
# relay_control      ip_relay startup/shutdown script
#
# Version: 1.1  ip_relay/relay_control  started: 2003-02-07 modified: 2016-01-01
#
# vicidial@gmail.com
#
# This script is released under the BSD license 
# (for compatibility with the ip_relay project)
# http://sourceforge.net/projects/iprelay/
#
# Thanks to Rachad ALAO (ralao@venus.org) for writing ip_relay
#
# Changes:
# 140619-0954 - Added new port 42569 for playback loops
# 160101-0912 - Added check for installed ip_relay binary
#

IPRELAY_BIN="/usr/bin/ip_relay"

if [ ! -x $IPRELAY_BIN ]; then
	IPRELAY_BIN="/usr/local/bin/ip_relay"
fi

case "$1" in
  start)

        echo "starting up ip_relay services at $IPRELAY_BIN"

        $IPRELAY_BIN 40569 127.0.0.1    4569 9999999 &
        $IPRELAY_BIN 41569 127.0.0.1    4569 9999999 &
        $IPRELAY_BIN 42569 127.0.0.1    4569 9999999 &

        echo "done "
        echo
        ;;

  status)

        echo "current running processes "

        ps -C ip_relay

        echo "Done "
        exit 0
        ;;

  restart|reload)
        $0 stop
        $0 start
        ;;

  stop)
        echo "Shutting down ip_relay services "

        # Turn off IP Forwarding
        echo "Running:  kill -9 `ps -C ip_relay -o pid --no-heading`"

        kill -9 `ps -C ip_relay -o pid --no-heading`

        echo "Done "

        echo
        ;;
  *)
        echo "Usage: relay_control {start|stop|status|restart|reload}"
        exit 1
esac

exit 0
